<Page x:Class="DataVisualizationPlatform.Views.HomePageB"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:local="clr-namespace:DataVisualizationPlatform.Controls"
      xmlns:vm="clr-namespace:DataVisualizationPlatform.ViewModels"
      mc:Ignorable="d"
      Title="HomePageB" 
      Style="{StaticResource Page_Style}">

    <Page.DataContext>
        <vm:HomePageBViewModel />
    </Page.DataContext>

    <Page.Resources>
        <!-- 引用样式资源 -->
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Styles/HomePageBStyle.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- 故障列表 -->
        <Button Grid.Column="0" 
                Grid.Row="0" 
                Grid.RowSpan="2"
                Cursor="Hand"
                Background="Transparent"
                BorderThickness="0"
                Margin="0,0,20,0">
            <Button.Template>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="CardBorder"
                    Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="12">
                        <ContentPresenter />
                        <Border.Effect>
                            <DropShadowEffect ShadowDepth="4" 
                                    Direction="315" 
                                    Color="#40000000" 
                                    Opacity="0.3" 
                                    BlurRadius="8"/>
                        </Border.Effect>
                    </Border>
                </ControlTemplate>
            </Button.Template>

            <Button.RenderTransform>
                <ScaleTransform ScaleX="1" ScaleY="1"/>
            </Button.RenderTransform>
            <Button.RenderTransformOrigin>0.5,0.5</Button.RenderTransformOrigin>

            <!-- 卡片内容 -->
            <Border Background="White"
                    CornerRadius="12"
                    Padding="20"
                    MinHeight="200">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 标题栏 -->
                    <Grid Grid.Row="0" Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- 故障图标 -->
                        <Border Grid.Column="0"
                                Background="#FFF3E0"
                                CornerRadius="8"
                                Width="40"
                                Height="40"
                                VerticalAlignment="Center">
                            <Path Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,6A1.5,1.5 0 0,1 13.5,7.5A1.5,1.5 0 0,1 12,9A1.5,1.5 0 0,1 10.5,7.5A1.5,1.5 0 0,1 12,6M12.5,11H11.5V18H12.5V11Z"
                                  Fill="#FF9800"
                                  Width="20"
                                  Height="20"
                                  Stretch="Uniform"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"/>
                        </Border>

                        <!-- 标题文本 -->
                        <StackPanel Grid.Column="1" 
                           Margin="12,0,0,0"
                           VerticalAlignment="Center">
                            <TextBlock Text="故障列表"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="#263238"/>
                        </StackPanel>

                        <!-- 状态指示器 -->
                        <Border Grid.Column="2"
                        Background="#FFEBEE"
                        CornerRadius="12"
                        Padding="8,4"
                        Margin="5,0,0,0"
                        VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Width="8" Height="8" 
                                Fill="#F44336" 
                                Margin="0,0,6,0"/>
                                <TextBlock
                                   FontSize="11"
                                   FontWeight="Medium"
                                   Foreground="#C62828">
                                    <Run Text="{Binding FaultReportList.Count, Mode=OneWay}" />
                                    <Run Text=" 个故障"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- 故障列表 -->
                    <ScrollViewer Grid.Row="1" 
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding FaultReportList}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button>

                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="Transparent">
                                                    <ContentPresenter 
                                                         HorizontalAlignment="Stretch" 
                                                         VerticalAlignment="Stretch"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Button.Template>

                                        <Border Background="#FAFAFA"
                                                CornerRadius="8"
                                                Padding="16,12"
                                                Margin="0,0,0,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <Ellipse Grid.Column="0"
                                                         Width="6" Height="6"
                                                         Fill="{Binding Fal_Info, Converter={StaticResource StatusToBrushConverter}}"
                                                         VerticalAlignment="Center"
                                                         Margin="0,0,5,0"/>
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding Fal_Eqid}"
                                                           FontSize="12"
                                                           Foreground="#424242"
                                                           VerticalAlignment="Center"
                                                           HorizontalAlignment="Left"/>
                                                <TextBlock Grid.Column="2"
                                                           Text="{Binding Fal_Type}"
                                                           FontSize="12"
                                                           Foreground="#424242"
                                                           VerticalAlignment="Center"
                                                           HorizontalAlignment="Left"/>
                                                <TextBlock Grid.Column="3"
                                                           Text="{Binding Fal_Info}"
                                                           FontSize="11"
                                                           Foreground="{Binding Fal_Info, Converter={StaticResource StatusToBrushConverter}}"
                                                           FontWeight="Medium"
                                                           VerticalAlignment="Center"
                                                           HorizontalAlignment="Right"/>
                                            </Grid>
                                        </Border>
                                    </Button>

                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                    </ScrollViewer>
                </Grid>
            </Border>
        </Button>

        <!-- 功能菜单 -->
        <Border Grid.Column="1"
                Grid.Row="0"
                Style="{StaticResource HPB_CardStyle}"
                Margin="0,0,20,0">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 功能菜单标题栏 -->
                <Grid Grid.Row="0" Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- 功能图标 -->
                    <Border Grid.Column="0"
                            Background="#E8F5E8"
                            CornerRadius="8"
                            Width="40"
                            Height="40"
                            VerticalAlignment="Center">
                        <Path Data="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.97 19.05,5.05L16.56,6.05C16.04,5.65 15.48,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.52,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.52,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.48,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.04 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"
                              Fill="#4CAF50"
                              Width="20"
                              Height="20"
                              Stretch="Uniform"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"/>
                    </Border>

                    <!-- 标题文本 -->
                    <StackPanel Grid.Column="1" 
                               Margin="12,0,0,0"
                               VerticalAlignment="Center">
                        <TextBlock Text="功能菜单"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Foreground="#263238"/>
                    </StackPanel>
                </Grid>

                <!-- 功能按钮网格 -->
                <UniformGrid Grid.Row="1" 
                             Columns="2" 
                             Margin="0,0,0,0">

                    <!-- 数据编辑按钮 -->
                    <Button Style="{StaticResource HPB_FunctionButtonStyle}"
                            Command="{Binding ExportDataCommand}">
                        <StackPanel Orientation="Vertical">
                            <Border Style="{StaticResource HPB_IconContainerStyle}"
                                    Background="#E3F2FD">
                                <Path Data="M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z"
                                      Fill="#1976D2"
                                      Width="16"
                                      Height="16"
                                      Stretch="Uniform"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="数据导出" 
                                       FontSize="12"
                                       FontWeight="Medium"
                                       Foreground="#424242"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- 查看报告按钮 -->
                    <Button Style="{StaticResource HPB_FunctionButtonStyle}"
                            Command="{Binding LogoutCommand}">
                        <StackPanel Orientation="Vertical">
                            <Border Style="{StaticResource HPB_IconContainerStyle}"
                                    Background="#FFF3E0">
                                <Path Data="M2,2V4H20V2H2M2,6V8H20V6H2M2,10V12H20V10H2M2,14V16H20V14H2M2,18V20H20V18H2Z"
                                      Fill="#FF9800"
                                      Width="16"
                                      Height="16"
                                      Stretch="Uniform"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="注销用户" 
                                       FontSize="12"
                                       FontWeight="Medium"
                                       Foreground="#424242"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- 数据编辑按钮 -->
                    <Button Style="{StaticResource HPB_FunctionButtonStyle}"
                            Command="{Binding EditDataCommand}">
                        <StackPanel Orientation="Vertical">
                            <Border Style="{StaticResource HPB_IconContainerStyle}"
                                    Background="#F3E5F5">
                                <Path Data="M16,11.78L20.24,4.45L21.97,5.45L16.74,14.5L10.23,10.75L5.46,19H22V21H2V3H4V17.54L9.5,8L16,11.78Z"
                                      Fill="#9C27B0"
                                      Width="16"
                                      Height="16"
                                      Stretch="Uniform"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="数据编辑"
                                       FontSize="12"
                                       FontWeight="Medium"
                                       Foreground="#424242"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- 系统设置按钮 -->
                    <Button Style="{StaticResource HPB_FunctionButtonStyle}"
                            Command="{Binding ViewReportCommand}">
                        <StackPanel Orientation="Vertical">
                            <Border Style="{StaticResource HPB_IconContainerStyle}"
                                    Background="#E8F5E8">
                                <Path Data="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11.03L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.78,8.95 21.73,9.22 21.54,9.37L19.43,11.03L19.5,12L19.43,12.97L21.54,14.63C21.73,14.78 21.78,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10M11.25,4L10.88,6.61C9.68,6.86 8.62,7.5 7.85,8.39L5.44,7.35L4.69,8.65L6.8,10.2C6.4,11.37 6.4,12.64 6.8,13.8L4.68,15.36L5.43,16.66L7.86,15.62C8.63,16.5 9.68,17.14 10.87,17.38L11.24,20H12.76L13.13,17.39C14.32,17.14 15.37,16.5 16.14,15.62L18.57,16.66L19.32,15.36L17.2,13.81C17.6,12.64 17.6,11.37 17.2,10.2L19.31,8.65L18.56,7.35L16.15,8.39C15.38,7.5 14.32,6.86 13.12,6.62L12.75,4H11.25Z"
                                      Fill="#4CAF50"
                                      Width="16"
                                      Height="16"
                                      Stretch="Uniform"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="系统设置" 
                                       FontSize="12"
                                       FontWeight="Medium"
                                       Foreground="#424242"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </UniformGrid>
            </Grid>
        </Border>

        <!-- 详细数据卡片 -->
        <Border Grid.Column="2"
                Grid.Row="0"
                Style="{StaticResource HPB_CardStyle}"
                Margin="0,0,0,0"
                MinWidth="280"
                MaxHeight="300">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 详细数据标题栏 -->
                <Grid Grid.Row="0" Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- 数据图标 -->
                    <Border Grid.Column="0"
                            Background="#E3F2FD"
                            CornerRadius="8"
                            Width="40"
                            Height="40"
                            VerticalAlignment="Center">
                        <Path Data="M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z"
                              Fill="#2196F3"
                              Width="20"
                              Height="20"
                              Stretch="Uniform"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"/>
                    </Border>

                    <!-- 标题文本 -->
                    <StackPanel Grid.Column="1" 
                               Margin="12,0,0,0"
                               VerticalAlignment="Center">
                        <TextBlock Text="数据概览"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Foreground="#263238"/>
                    </StackPanel>
                </Grid>

                <!-- 数据统计区域 -->
                <ScrollViewer Grid.Row="1" 
                              VerticalScrollBarVisibility="Hidden"
                              HorizontalScrollBarVisibility="Disabled">
                    <ItemsControl ItemsSource="{Binding CurrentEquipmentStats}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="0,0,0,8">
                                    <!-- 设备标题 -->
                                    <TextBlock Text="{Binding EquipmentId, StringFormat='设备: {0}'}"
                               FontSize="13"
                               FontWeight="SemiBold"
                               Foreground="#263238"
                               Margin="0,0,0,6"/>

                                    <!-- 累计订单 -->
                                    <Border Background="#F8F9FA"
                            CornerRadius="8"
                            Padding="16,10"
                            Margin="0,0,0,6">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <Border Grid.Column="0"
                                    Background="#E3F2FD"
                                    CornerRadius="6"
                                    Width="24" Height="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,10,0">
                                                <Path Data="M9,10H7V12H9V10M13,10H11V12H13V10M17,10H15V12H17V10M19,3H18V1H16V3H8V1H6V3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z"
                                      Fill="#2196F3"
                                      Width="12"
                                      Height="12"
                                      Stretch="Uniform"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"/>
                                            </Border>

                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="累计订单"
                                           FontSize="11"
                                           Foreground="#757575"/>
                                                <TextBlock Text="{Binding TotalOrders}"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Foreground="#2196F3"/>
                                            </StackPanel>

                                            <TextBlock Grid.Column="2"
                                       Text="{Binding TrendIndicator}"
                                       FontSize="10"
                                       Foreground="{Binding TrendColor}"
                                       FontWeight="Medium"
                                       VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>

                                    <!-- 固定时长占比 -->
                                    <Border Background="#F8F9FA"
                            CornerRadius="8"
                            Padding="16,10"
                            Margin="0,0,0,6">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <Border Grid.Column="0"
                                    Background="#FFF3E0"
                                    CornerRadius="6"
                                    Width="24" Height="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,10,0">
                                                <Path Data="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"
                                      Fill="#FF9800"
                                      Width="12"
                                      Height="12"
                                      Stretch="Uniform"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"/>
                                            </Border>

                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="固定时长占比"
                                           FontSize="11"
                                           Foreground="#757575"/>
                                                <TextBlock FontSize="16"
                                           FontWeight="Bold"
                                           Foreground="#FF9800">
                                    <Run Text="{Binding FixedDurationRatio}"/>
                                    <Run Text="%"/>
                                                </TextBlock>
                                            </StackPanel>

                                            <TextBlock Grid.Column="2"
                                       Text="{Binding TrendIndicator}"
                                       FontSize="10"
                                       Foreground="{Binding TrendColor}"
                                       FontWeight="Medium"
                                       VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>

                                    <!-- 故障率 -->
                                    <Border Background="#F8F9FA"
                            CornerRadius="8"
                            Padding="16,10">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <Border Grid.Column="0"
                                    Background="#FFEBEE"
                                    CornerRadius="6"
                                    Width="24" Height="24"
                                    VerticalAlignment="Center"
                                    Margin="0,0,10,0">
                                                <Path Data="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"
                                      Fill="#F44336"
                                      Width="12"
                                      Height="12"
                                      Stretch="Uniform"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"/>
                                            </Border>

                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="故障率"
                                           FontSize="11"
                                           Foreground="#757575"/>
                                                <TextBlock FontSize="16"
                                           FontWeight="Bold"
                                           Foreground="#F44336">
                                    <Run Text="{Binding FaultRate}"/>
                                    <Run Text="%"/>
                                                </TextBlock>
                                            </StackPanel>

                                            <TextBlock Grid.Column="2"
                                       Text="{Binding TrendIndicator}"
                                       FontSize="10"
                                       Foreground="{Binding TrendColor}"
                                       FontWeight="Medium"
                                       VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>

                                    <!-- 分隔线 -->
                                    <Border Height="1" 
                            Background="#E0E0E0"
                            Margin="0,8,0,0"
                            Opacity="0.5"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- 图表容器 (包含标题) -->
        <Grid Grid.Row="1" 
              Grid.Column="1" 
              Grid.ColumnSpan="2"
              Margin="0,20,0,0">

            <!-- 柱状图 -->
            <Border Style="{StaticResource ChartContainerStyle}">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="4" 
                                      Direction="315" 
                                      Color="#40000000" 
                                      Opacity="0.3" 
                                      BlurRadius="8"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 标题 -->
                    <TextBlock Grid.Row="0" 
                               Text="年度订单数据"
                               Style="{StaticResource TitleTextStyle}"
                               HorizontalAlignment="Center"
                               Margin="0,20,0,16"/>

                    <!-- 图表 -->
                    <Grid Grid.Row="1" Margin="10,0,10,10">
                        <local:AnimatedBarChart Height="Auto"
                                              DataItems="{Binding BarData}"
                                              AnimationProgress="{Binding AnimationProgress}"/>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>