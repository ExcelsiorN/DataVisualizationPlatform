<Page x:Class="DataVisualizationPlatform.Views.HomePageC"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:DataVisualizationPlatform.Views"
      xmlns:vm="clr-namespace:DataVisualizationPlatform.ViewModels"
      xmlns:ctr="clr-namespace:DataVisualizationPlatform.Controls"
      xmlns:gmap="clr-namespace:GMap.NET.WindowsPresentation;assembly=GMap.NET.WindowsPresentation"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="HomePageC"
      Name="MaPage"
      Style="{StaticResource Page_Style}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 地图控件 -->
        <Border Grid.Column="0"
                CornerRadius="20,0,0,20"
                BorderThickness="0"
                ClipToBounds="True">
            <Border.OpacityMask>
                <VisualBrush>
                    <VisualBrush.Visual>
                        <Border Background="Black" 
                                CornerRadius="20,0,0,20"
                                Width="{Binding RelativeSource={RelativeSource AncestorType=Border}, Path=ActualWidth}"
                                Height="{Binding RelativeSource={RelativeSource AncestorType=Border}, Path=ActualHeight}"/>
                    </VisualBrush.Visual>
                </VisualBrush>
            </Border.OpacityMask>
            
            <gmap:GMapControl x:Name="MapControl"
                              Zoom="{Binding Zoom, Mode=TwoWay}"
                              MinZoom="2"
                              MaxZoom="18"
                              Position="{Binding Position, Mode=TwoWay}"
                              MapProvider="{Binding MapProvider}"
                              CanDragMap="True"
                              MouseWheelZoomType="MousePositionAndCenter"/>          
        </Border>




        <!-- 设备列表面板 -->
        <Border Grid.Column="1"  
                BorderBrush="White"
                BorderThickness="0"
                Background="White"
                CornerRadius="0,20,20,0"
                ClipToBounds="True">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 标题栏 -->
                <Border Grid.Row="0" 
                        Background="#FFFFFF" 
                        BorderBrush="#E9ECEF" 
                        BorderThickness="0,0,0,1"
                        Padding="20,15"
                        CornerRadius="0,20,0,0"
                        ClipToBounds="True">        
                    <StackPanel>
                        <TextBlock Text="设备列表" 
                                   FontSize="18" 
                                   FontWeight="SemiBold" 
                                   Foreground="#212529"/>           
                        <TextBlock Text="{Binding EquipmentList.Count, StringFormat='共 {0} 台设备'}" 
                                   FontSize="12" 
                                   Foreground="#6C757D" 
                                   Margin="0,5,0,0"/>          
                    </StackPanel>
                </Border>

                <!-- 设备列表 -->
                <Border Grid.Row="1" 
                        Background="#FFFFFF" 
                        BorderBrush="#E9ECEF" 
                        BorderThickness="0,0,0,1"
                        Padding="20,15"
                        CornerRadius="0,0,20,0"
                        ClipToBounds="True">

                    <ScrollViewer Padding="20" 
                                  Background="white"
                                  VerticalScrollBarVisibility="Hidden"
                                  HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding EquipmentList}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel IsItemsHost="True" Orientation="Vertical" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Command="{Binding DataContext.LocateCommand, ElementName=MaPage}" 
                                            CommandParameter="{Binding Equ_DeploymentAddress}"
                                            Style="{StaticResource EquipmentCardButtonStyle}"
                                            Margin="0,0,0,10">
                                        <Grid Margin="15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- 设备图标 -->
                                            <Grid Grid.Column="0" VerticalAlignment="Center">
                                                <Ellipse Width="50" Height="50" Fill="#E3F2FD"/>
                                                <Image Source="\Resources\Images\XYLogo.png" 
                                                    Height="20" Width="30"/>
                                            </Grid>

                                            <!-- 设备信息 -->
                                            <StackPanel Grid.Column="1" 
                                                        VerticalAlignment="Center" 
                                                        Margin="15,4,0,4">
                                                <TextBlock Text="{Binding Equ_Name}" 
                                                           Style="{StaticResource EquipmentNameTextStyle}"/>

                                                <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                                                    <TextBlock Text="ID: " 
                                                               Style="{StaticResource EquipmentIdTextStyle}"
                                                               FontWeight="SemiBold"/>
                                                    <TextBlock Text="{Binding Equ_Id}"
                                                        Style="{StaticResource EquipmentIdTextStyle}"/>
                                                </StackPanel>

                                                <StackPanel Orientation="Horizontal">
                                                    <Path Fill="#ADB5BD" 
                                                          Width="20" Height="25"
                                                          VerticalAlignment="Center"
                                                          Margin="0,-5,5,0"
                                                          Data="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"/>
                                                    <TextBlock Text="{Binding Equ_DeploymentAddress}"
                                                               Style="{StaticResource EquipmentAddressTextStyle}"
                                                               TextWrapping="Wrap"/>
                                                </StackPanel>
                                            </StackPanel>

                                            <!-- 箭头指示器 -->
                                            <Path Grid.Column="2" 
                                                  Fill="#ADB5BD" 
                                                  Width="16" Height="16"
                                                  VerticalAlignment="Center"
                                                  Data="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Page>